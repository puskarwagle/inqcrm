# AI Agent Coding Standards & File Structure Guide

**Version:** 1.1  
**Last Updated:** November 14, 2025 (Updated with critical fixes)
**Project:** Krayin CRM - Laravel-based Modular Package System

---

## Quick Reference: Technology Stack

- **PHP:** ^8.2 (with strict types)
- **Laravel:** ^10.0
- **Testing:** Pest ^2.6 (with Laravel plugin ^2.1)
- **Package Management:** Konekt Concord ^1.10
- **Code Formatting:** Laravel Pint ^1.16

---

## Table of Contents

1. [Code of Conduct](#code-of-conduct)
2. [Project Architecture Overview](#project-architecture-overview)
3. [Technology Stack Requirements](#technology-stack-requirements)
4. [Package Structure Standards](#package-structure-standards)
5. [File Organization Guidelines](#file-organization-guidelines)
6. [Code Quality Standards](#code-quality-standards)
7. [Security Standards](#security-standards)
8. [AI Agent Operating Principles](#ai-agent-operating-principles)

---

## Code of Conduct

All code generated by AI agents MUST adhere to the Covenant Code of Conduct and project values:

### Core Principles (Inspired by Covenant Code of Conduct)

1. **Respect & Inclusivity**
   - Generate code that is welcoming to all developers
   - Avoid hardcoded assumptions about user contexts
   - Make code accessible and understandable

2. **Excellence & Quality**
   - Write clean, maintainable, and well-documented code
   - Follow established patterns and conventions
   - Prioritize security and performance

3. **Accountability**
   - Add clear comments for complex logic
   - Ensure generated code is reviewed and tested
   - Take responsibility for generated code quality
   - Include proper error handling

4. **Transparency**
   - Clearly indicate generated vs. existing code
   - Document dependencies and assumptions
   - Provide rationale for architectural decisions

5. **Community Focus**
   - Generate code that supports team collaboration
   - Follow project conventions over personal preferences
   - Make code easily understood by team members

---

## Project Architecture Overview

### Krayin CRM Structure

Krayin is a **modular, Laravel-based CRM system** with the following characteristics:

```
laravel-crm/
├── app/                          # Main Laravel application code
├── packages/Webkul/              # Core modular packages (19 modules)
├── config/                       # Application configuration
├── database/                     # Migrations and seeders
├── resources/                    # Frontend assets and views
├── routes/                       # API and web routes
├── storage/                      # Application storage
├── tests/                        # Test suites
└── vendor/                       # Composer dependencies
```

### Key Modules in `packages/Webkul/`

| Module | Purpose | Status |
|--------|---------|--------|
| **Core** | Foundation utilities, ACL, system config | Foundation |
| **Admin** | Admin interface, data grids, notifications | Core Feature |
| **Contact** | Contact management | Core Feature |
| **User** | User management & authentication | Core Feature |
| **Lead** | Lead management & conversion | Core Feature |
| **Activity** | Activity tracking & timeline | Core Feature |
| **Email** | Email management & integrations | Core Feature |
| **EmailTemplate** | Email template management | Core Feature |
| **Automation** | Workflow automation engine | Advanced |
| **Marketing** | Marketing campaigns & segmentation | Advanced |
| **Quote** | Quote generation & management | Advanced |
| **Product** | Product catalog management | Core Feature |
| **Attribute** | Custom attributes system | Foundation |
| **Tag** | Tagging system | Core Feature |
| **DataGrid** | Data table rendering | Foundation |
| **DataTransfer** | Import/export functionality | Utility |
| **WebForm** | Web form builder & submissions | Advanced |
| **Warehouse** | Inventory management | Advanced |
| **Installer** | Application installer | Setup |

---

## Technology Stack Requirements

**IMPORTANT:** All code generation must target the specified technology versions. Using older versions is NOT permitted.

### Core Requirements

| Technology | Version | Requirement | Notes |
|------------|---------|-------------|-------|
| **PHP** | ^8.2 | Required | Must use strict types: `declare(strict_types=1);` |
| **Laravel** | ^10.0 | Required | Current LTS version |
| **Pest** | ^2.6 | Required | Primary testing framework |
| **Pest Laravel Plugin** | ^2.1 | Required | For Laravel-specific Pest features |
| **Konekt Concord** | ^1.10 | Required | Package management & discovery |
| **Laravel Pint** | ^1.16 | Required | Code formatting & standards |

### Development Dependencies

- **Laravel Debugbar:** ^3.6 (debugging)
- **PHPStan:** ^1.0 (static analysis - recommended)
- **Spatie Laravel Ignition:** ^2.0 (error pages)

### Violation of Version Requirements

⚠️ **CRITICAL:** Never generate code for:
- PHP 8.1 or earlier
- Laravel 9.x or earlier
- PHPUnit only (must use Pest framework)
- Outdated package versions

---

## Package Structure Standards

### Standard Laravel Package Structure

Each package in `packages/Webkul/` follows this structure:

```
PackageName/
├── composer.json                 # Package metadata & dependencies
├── package.json                  # Frontend dependencies (if applicable)
├── src/
│   ├── Contracts/                # Interfaces and contracts
│   ├── Models/                   # Eloquent models
│   ├── Repositories/             # Data access layer
│   ├── Providers/                # Service providers
│   ├── Http/
│   │   ├── Controllers/          # Route controllers
│   │   ├── Requests/             # Form validation requests
│   │   └── Resources/            # API resources
│   ├── Database/
│   │   ├── Migrations/           # Schema migrations
│   │   └── Seeders/              # Database seeders
│   ├── Exceptions/               # Custom exceptions
│   ├── Facades/                  # Facade classes
│   ├── Helpers/                  # Helper functions
│   ├── Listeners/                # Event listeners
│   ├── Traits/                   # Reusable traits
│   ├── Resources/                # Language files, views
│   └── Routes/                   # Package routes
├── tests/                        # PHPUnit/Pest tests
├── config/                       # Package configuration
├── resources/                    # Frontend assets, views
├── .gitignore                    # Git ignore rules
├── postcss.config.cjs            # PostCSS configuration (if needed)
├── tailwind.config.js            # Tailwind CSS configuration (if needed)
├── vite.config.js                # Vite bundler configuration (if needed)
└── tests/                        # Test specifications

```

### composer.json Standards

```json
{
    "name": "krayin/laravel-{module-name}",
    "description": "Brief description of module functionality",
    "license": "MIT",
    "authors": [
        {
            "name": "Developer Name",
            "email": "email@example.com"
        }
    ],
    "require": {
        "php": "^8.2",
        "krayin/laravel-core": "^1.0"
    },
    "autoload": {
        "psr-4": {
            "Webkul\\ModuleName\\": "src/"
        }
    },
    "extra": {
        "laravel": {
            "providers": [
                "Webkul\\ModuleName\\Providers\\ModuleNameServiceProvider"
            ],
            "aliases": {}
        },
        "concord": {
            "modules": [
                "Webkul\\ModuleName"
            ]
        }
    },
    "minimum-stability": "dev"
}
```

### Konekt Concord Module Definition

Each package must include a Module class for Concord integration:

```php
<?php

namespace Webkul\ModuleName;

use Konekt\Concord\Module as BaseModule;

class Module extends BaseModule
{
    public static function getId(): string
    {
        return 'webkul.module-name';
    }

    public static function getName(): string
    {
        return 'Module Display Name';
    }

    public static function getVersion(): string
    {
        return '1.0.0';
    }
}
```

---

## File Organization Guidelines

### Naming Conventions

#### PHP Classes
- **PascalCase** for class names: `UserRepository`, `ContactModel`, `AdminController`
- **Namespace Pattern**: `Webkul\ModuleName\SubNamespace\ClassName`
- **Interfaces**: Prefix with `I` or suffix with `Contract` (project uses `Contract`): `ContactContract`
- **Traits**: Descriptive names ending in pattern they provide: `HasTimestamps`, `SoftDeletes`, `HasAttributes`
- **Exceptions**: Suffix with `Exception`: `InvalidContactException`, `ModelNotFoundException`

#### Files
- **Controllers**: Singular + `Controller`: `ContactController.php`
- **Models**: Singular + `Model`: `Contact.php` (no suffix needed, Laravel convention)
- **Repositories**: Singular + `Repository`: `ContactRepository.php`
- **Requests**: Action + `Request`: `CreateContactRequest.php`, `UpdateContactRequest.php`
- **Resources**: Singular + `Resource`: `ContactResource.php`
- **Migrations**: `YYYY_MM_DD_HHMMSS_create_table_name_table.php`
- **Seeders**: Table name + `Seeder`: `ContactsTableSeeder.php`

#### Database
- **Tables**: Plural snake_case: `contacts`, `email_templates`, `user_roles`
- **Columns**: snake_case: `first_name`, `is_active`, `created_at`
- **Foreign Keys**: `{table}_id`: `contact_id`, `user_id`, `role_id`
- **Boolean Columns**: Prefix with `is_` or `has_`: `is_active`, `has_read_emails`

### Directory Organization Principles

**Level 1: By Layer (Vertical Organization)**
- `Contracts/` - Interfaces
- `Models/` - Data models
- `Repositories/` - Data access
- `Http/` - HTTP layer (Controllers, Requests, Resources)
- `Database/` - Migrations, Seeders
- `Providers/` - Service providers

**Level 2: By Feature (Within Http/)**
```
Http/
├── Controllers/
│   ├── ContactController.php
│   ├── LeadController.php
│   └── ...
├── Requests/
│   ├── CreateContactRequest.php
│   ├── UpdateContactRequest.php
│   └── ...
├── Resources/
│   ├── ContactResource.php
│   └── ...
└── Middleware/
    └── ...
```

### Frontend File Organization

```
resources/
├── css/
│   ├── index.css
│   └── tailwind.css
├── js/
│   ├── app.js
│   ├── components/
│   │   ├── ContactForm.vue
│   │   ├── ContactList.vue
│   │   └── ...
│   └── pages/
│       ├── Contact/
│       │   ├── Create.vue
│       │   ├── Edit.vue
│       │   └── Index.vue
│       └── ...
└── views/
    ├── layouts/
    │   ├── app.blade.php
    │   └── admin.blade.php
    ├── pages/
    └── components/
```

---

## Code Quality Standards

### PHP Code Standards

#### PSR-12 Extended Compliance

```php
<?php

namespace Webkul\Contact\Http\Controllers;

use Webkul\Contact\Contracts\Contact as ContactContract;
use Webkul\Contact\Repositories\ContactRepository;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class ContactController extends Controller
{
    /**
     * Create a new controller instance.
     *
     * @param  \Webkul\Contact\Repositories\ContactRepository  $contactRepository
     * @return void
     */
    public function __construct(
        private ContactRepository $contactRepository
    ) {}

    /**
     * Display a listing of contacts.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\JsonResponse
     */
    public function index(Request $request): JsonResponse
    {
        try {
            $contacts = $this->contactRepository
                ->query()
                ->paginate($request->get('per_page', 15));

            return response()->json([
                'status'  => 'success',
                'message' => 'Contacts retrieved successfully',
                'data'    => $contacts,
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'status'  => 'error',
                'message' => $e->getMessage(),
            ], 500);
        }
    }

    /**
     * Store a newly created resource in storage.
     *
     * @param  \Webkul\Contact\Http\Requests\CreateContactRequest  $request
     * @return \Illuminate\Http\JsonResponse
     */
    public function store(CreateContactRequest $request): JsonResponse
    {
        try {
            $contact = $this->contactRepository->create(
                $request->validated()
            );

            return response()->json([
                'status'  => 'success',
                'message' => 'Contact created successfully',
                'data'    => $contact,
            ], 201);
        } catch (\Exception $e) {
            return response()->json([
                'status'  => 'error',
                'message' => 'Failed to create contact',
                'details' => $e->getMessage(),
            ], 500);
        }
    }
}
```

#### Key Standards

1. **Type Hints**: Always use strict type hints for parameters and return types
   ```php
   public function update(int $id, UpdateRequest $request): array
   ```

2. **Comments**: Follow PHPDoc standards
   ```php
   /**
    * Description of what the method does.
    *
    * @param  Type  $param  Description
    * @return Type  Description of return value
    * @throws ExceptionClass  When this exception is thrown
    */
   ```

3. **Error Handling**: Always use try-catch for database operations
   ```php
   try {
       // Operation
   } catch (\Exception $e) {
       // Log and return appropriate response
       \Log::error('Operation failed', ['error' => $e->getMessage()]);
       throw new CustomException('User-friendly message');
   }
   ```

4. **Property Access**: Use dependency injection and constructor property promotion
   ```php
   public function __construct(
       private ContactRepository $repository,
       private ContactService $service
   ) {}
   ```

5. **Eloquent Standards**
   - Use relationships instead of manual joins
   - Use scopes for common query filters
   - Leverage collection methods for transformations

### Database Migration Standards

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up(): void
    {
        Schema::create('contacts', function (Blueprint $table) {
            $table->id();
            $table->string('first_name');
            $table->string('last_name');
            $table->string('email')->unique();
            $table->string('phone')->nullable();
            $table->text('address')->nullable();
            $table->boolean('is_active')->default(true);
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->softDeletes();
            $table->timestamps();

            $table->index(['user_id', 'created_at']);
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down(): void
    {
        Schema::dropIfExists('contacts');
    }
};
```

### Model Standards

```php
<?php

namespace Webkul\Contact\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Contact extends Model
{
    use SoftDeletes;

    /**
     * The attributes that are mass assignable.
     *
     * @var array<int, string>
     */
    protected $fillable = [
        'first_name',
        'last_name',
        'email',
        'phone',
        'address',
        'is_active',
        'user_id',
    ];

    /**
     * The attributes that should be cast.
     *
     * @var array<string, string>
     */
    protected $casts = [
        'is_active' => 'boolean',
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
    ];

    /**
     * Get the owner of the contact.
     *
     * @return \Illuminate\Database\Eloquent\Relations\BelongsTo
     */
    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }

    /**
     * Get all activities for this contact.
     *
     * @return \Illuminate\Database\Eloquent\Relations\HasMany
     */
    public function activities(): HasMany
    {
        return $this->hasMany(Activity::class);
    }
}
```

### Repository Pattern Standards

```php
<?php

namespace Webkul\Contact\Repositories;

use Webkul\Contact\Models\Contact;
use Illuminate\Database\Eloquent\Collection;
use Illuminate\Pagination\Paginator;

class ContactRepository
{
    /**
     * Create a new repository instance.
     *
     * @param  \Webkul\Contact\Models\Contact  $model
     */
    public function __construct(
        private Contact $model
    ) {}

    /**
     * Get query builder instance.
     *
     * @return \Illuminate\Database\Eloquent\Builder
     */
    public function query()
    {
        return $this->model->query();
    }

    /**
     * Get all contacts.
     *
     * @return \Illuminate\Database\Eloquent\Collection
     */
    public function all(): Collection
    {
        return $this->query()->get();
    }

    /**
     * Find a contact by ID.
     *
     * @param  int  $id
     * @return \Webkul\Contact\Models\Contact|null
     */
    public function find(int $id): ?Contact
    {
        return $this->query()->find($id);
    }

    /**
     * Create a new contact.
     *
     * @param  array  $data
     * @return \Webkul\Contact\Models\Contact
     */
    public function create(array $data): Contact
    {
        return $this->model->create($data);
    }

    /**
     * Update a contact.
     *
     * @param  int  $id
     * @param  array  $data
     * @return bool
     */
    public function update(int $id, array $data): bool
    {
        return $this->query()
            ->find($id)
            ->update($data);
    }

    /**
     * Delete a contact.
     *
     * @param  int  $id
     * @return bool
     */
    public function delete(int $id): bool
    {
        return $this->query()
            ->find($id)
            ->delete();
    }
}
```

### Validation Request Standards

```php
<?php

namespace Webkul\Contact\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class CreateContactRequest extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     *
     * @return bool
     */
    public function authorize(): bool
    {
        return auth()->check();
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, mixed>
     */
    public function rules(): array
    {
        return [
            'first_name' => ['required', 'string', 'max:255'],
            'last_name'  => ['required', 'string', 'max:255'],
            'email'      => ['required', 'email', 'unique:contacts,email'],
            'phone'      => ['nullable', 'string', 'max:20'],
            'address'    => ['nullable', 'string', 'max:500'],
        ];
    }

    /**
     * Get custom messages for validator errors.
     *
     * @return array<string, string>
     */
    public function messages(): array
    {
        return [
            'first_name.required' => 'First name is required.',
            'email.unique'        => 'This email address is already registered.',
        ];
    }
}
```

---

## Security Standards

**Security is non-negotiable in CRM systems.** All code MUST follow these security standards.

### Input Validation & Sanitization

#### Form Request Validation (REQUIRED)

```php
<?php

namespace Webkul\Contact\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class CreateContactRequest extends FormRequest
{
    public function authorize(): bool
    {
        // Always authorize before processing
        return auth()->check();
    }

    public function rules(): array
    {
        return [
            'email' => ['required', 'email', 'unique:contacts,email'],
            'first_name' => ['required', 'string', 'max:255'],
            'last_name' => ['required', 'string', 'max:255'],
            'phone' => ['nullable', 'string', 'regex:/^\+?[\d\s\-()]+$/'],
        ];
    }

    public function messages(): array
    {
        return [
            'email.unique' => 'This email is already registered.',
            'phone.regex' => 'Phone number format is invalid.',
        ];
    }
}
```

#### NEVER:
```php
// ❌ BAD: Direct $_POST access
$email = $_POST['email'];

// ❌ BAD: Unvalidated input to database
$contact = Contact::create(request()->all());

// ❌ BAD: Inline HTML without escaping
echo "Contact: " . $contact->email;
```

### SQL Injection Prevention

#### ✅ CORRECT: Use Eloquent/Query Builder

```php
// Good: Parameterized queries
$contacts = Contact::where('email', $email)->first();

// Good: Using query builder
$contacts = DB::table('contacts')
    ->where('email', '=', $email)
    ->get();

// Good: Raw queries with bindings
$contacts = DB::select('SELECT * FROM contacts WHERE email = ?', [$email]);
```

#### ❌ WRONG: Raw SQL Concatenation

```php
// NEVER DO THIS
$sql = "SELECT * FROM contacts WHERE email = '" . $email . "'";
DB::select(DB::raw($sql));
```

### Authorization & Authentication

#### Use Authorization Gates & Policies

```php
// In AuthServiceProvider
Gate::define('update-contact', function (User $user, Contact $contact) {
    return $user->id === $contact->user_id;
});

// In Controller
if (! Gate::allows('update-contact', $contact)) {
    abort(403, 'Unauthorized action.');
}

// Or using authorize() method
$this->authorize('update-contact', $contact);
```

### Data Privacy & Audit

#### Use Soft Deletes for Sensitive Data

```php
// In migration
Schema::create('contacts', function (Blueprint $table) {
    // ... columns ...
    $table->softDeletes();
    $table->timestamps();
});

// In model
use Illuminate\Database\Eloquent\SoftDeletes;

class Contact extends Model
{
    use SoftDeletes;
}
```

#### Never Log Sensitive Information

```php
// ❌ BAD: Logs password
\Log::info('User login', ['password' => $password]);

// ✅ GOOD: Only logs necessary info
\Log::info('User login attempt', ['user_id' => $user->id, 'ip' => request()->ip()]);
```

### Cross-Site Scripting (XSS) Prevention

#### In Blade Templates: Always Escape Output

```blade
{{-- ✅ CORRECT: Escaped output --}}
{{ $contact->email }}
{{ $contact->first_name }}

{{-- ❌ WRONG: Unescaped output (XSS vulnerability) --}}
{!! $contact->email !!}

{{-- ✅ CORRECT: Only use {!! for trusted content --}}
{!! markdown_to_html($contact->description) !!}
```

#### In JSON Responses

```php
// ✅ CORRECT: Automatically escaped
return response()->json(['email' => $contact->email]);

// ❌ WRONG: Never use json_encode without proper escaping
return response($this->makeSomeUnsafeJson());
```

### Dependency Security

#### Keep Dependencies Updated

```bash
# Regular security audits
composer audit

# Update safely
composer update

# Check for known vulnerabilities
composer require --dev roave/security-advisories:dev-latest
```

---

## AI Agent Operating Principles

### Responsibilities

1. **Understanding the Codebase**
   - Analyze the modular package structure before making changes
   - Respect existing architectural patterns and conventions
   - Maintain consistency with established code standards

2. **Code Generation**
   - Generate code that follows all standards in this document
   - Include comprehensive comments and documentation
   - Ensure type safety and proper error handling
   - Test generated code mentally against edge cases

3. **Preservation of Intent**
   - Maintain the project's modular philosophy
   - Respect separation of concerns
   - Keep related functionality in appropriate layers

4. **Quality Assurance**
   - Check for security vulnerabilities (SQL injection, XSS, etc.)
   - Verify database migrations are properly indexed
   - Ensure proper exception handling and logging
   - Validate input data appropriately

### Before Generating Code

- [ ] Understand the module and its dependencies
- [ ] Check existing similar implementations for patterns
- [ ] Verify the file goes in the correct directory
- [ ] Confirm naming conventions are followed
- [ ] Check for required interfaces/contracts
- [ ] Ensure proper namespace usage

### During Code Generation

- [ ] Use type hints consistently
- [ ] Add comprehensive PHPDoc comments
- [ ] Include error handling
- [ ] Follow PSR-12 standards
- [ ] Use dependency injection
- [ ] Implement proper database indexing
- [ ] Add input validation

### After Code Generation

- [ ] Verify imports are correct
- [ ] Check for unused imports
- [ ] Confirm method signatures match interfaces
- [ ] Validate database constraints
- [ ] Test edge cases mentally
- [ ] Document any new public methods

### Common Pitfalls to Avoid

| ❌ Don't | ✅ Do |
|----------|------|
| Hardcode values | Use configuration files and environment variables |
| Ignore error handling | Wrap operations in try-catch, return meaningful errors |
| Skip validation | Validate all user input thoroughly |
| Create circular dependencies | Respect module boundaries |
| Use god objects | Keep classes focused and single-responsibility |
| Forget type hints | Always use type hints for parameters and returns |
| Write SQL directly | Use Eloquent ORM and query builder |
| Ignore indexing | Add indexes to frequently queried columns |
| Skip tests | Include unit tests for critical logic |
| Miss documentation | Document public APIs and complex logic |

### Module Communication

**Allowed Dependencies**
- Child modules can depend on Core
- Modules can use shared Contracts
- Cross-module communication through Events/Listeners

**Avoid**
- Circular dependencies between modules
- Direct model access outside repositories
- Business logic in controllers

### Testing Standards

**IMPORTANT:** All tests must use Pest framework, NOT PHPUnit directly.

#### Pest Testing Framework (Required)

```php
<?php

use Webkul\Contact\Models\Contact;
use Webkul\Contact\Repositories\ContactRepository;

describe('ContactRepository', function () {
    let('repository', fn () => new ContactRepository(new Contact()));

    describe('create', function () {
        it('creates a contact with valid data', function () {
            $data = [
                'first_name' => 'John',
                'last_name'  => 'Doe',
                'email'      => 'john@example.com',
            ];

            $contact = $this->repository->create($data);

            expect($contact)->toBeInstanceOf(Contact::class);
            expect($contact->first_name)->toBe('John');
            expect($contact->email)->toBe('john@example.com');
        });

        it('fails with invalid email', function () {
            $data = [
                'first_name' => 'John',
                'last_name'  => 'Doe',
                'email'      => 'invalid-email',
            ];

            // Assuming validation throws exception
            $this->expectException(\Illuminate\Validation\ValidationException::class);
            $this->repository->create($data);
        });
    });

    describe('find', function () {
        it('returns contact by id', function () {
            $contact = Contact::factory()->create();

            $found = $this->repository->find($contact->id);

            expect($found)->not->toBeNull();
            expect($found->id)->toBe($contact->id);
        });

        it('returns null for non-existent id', function () {
            $found = $this->repository->find(99999);

            expect($found)->toBeNull();
        });
    });

    describe('delete', function () {
        it('deletes a contact', function () {
            $contact = Contact::factory()->create();
            $id = $contact->id;

            $this->repository->delete($id);

            expect($this->repository->find($id))->toBeNull();
        });
    });
});
```

#### Test Naming Conventions

```php
// ✅ CORRECT: Descriptive test names using 'it' or 'test_'
it('creates a contact with valid data');
test('returns null for non-existent contact');

// ❌ WRONG: Vague names
test('test');
it('works');
```

#### Coverage Expectations

- **Critical Logic:** 100% coverage required
- **Controllers:** 80% minimum
- **Repositories:** 90% minimum
- **Models:** 70% minimum
- **Utility Classes:** 90% minimum

---

## Appendix: Quick Reference

### Directory Structure Template

```bash
packages/Webkul/NewModule/
├── composer.json
├── package.json                 # (if frontend assets)
├── src/
│   ├── Contracts/
│   ├── Models/
│   ├── Repositories/
│   ├── Providers/
│   ├── Http/Controllers/
│   ├── Http/Requests/
│   ├── Http/Resources/
│   ├── Database/Migrations/
│   ├── Database/Seeders/
│   ├── Exceptions/
│   ├── Facades/
│   ├── Helpers/
│   ├── Listeners/
│   ├── Traits/
│   └── Routes/
├── resources/
│   ├── css/
│   ├── js/
│   └── views/
├── tests/
├── config/
└── .gitignore
```

### PSR-12 Quick Rules

- 4-space indentation
- Line length should be 80 characters or fewer
- 2 blank lines between top-level declarations
- 1 blank line between methods
- Opening brace on same line for classes, next line for functions
- Always use strict types: `declare(strict_types=1);`

### Commit Message Template

```
<type>(<scope>): <subject>

<body>

<footer>
```

Types: feat, fix, docs, style, refactor, perf, test, chore  
Example: `feat(contact): add contact search functionality`

---

**Document Status**: Approved for AI Agent Implementation (v1.1)  
**Last Updated**: November 14, 2025  
**Critical Issues Fixed**: 3
  - ✅ PHP version updated to 8.2
  - ✅ Pest framework documentation added
  - ✅ Konekt Concord integration added
**Next Review Date**: Q1 2026  
**Contact**: Project Architecture Team

---

## Appendix A: Additional Resources

### Review & Improvements Document
See `DOCUMENT_REVIEW_AND_IMPROVEMENTS.md` for:
- Detailed gap analysis
- Enhancement recommendations
- Performance optimization guidelines
- Troubleshooting section

### Reference Links
- [Laravel 10 Documentation](https://laravel.com/docs/10.x)
- [Pest Framework Documentation](https://pestphp.com/)
- [Konekt Concord Documentation](https://konekt.dev/concord)
- [PSR-12 Coding Standards](https://www.php-fig.org/psr/psr-12/)
- [OWASP Security Guidelines](https://owasp.org/)
